const d3 = require("d3"),
      fs = require("fs");

console.log("load state suburb data ...");
fs.readFile("stateSuburbs.geojson", "utf8", function(error, data) {
  if (error) throw error;

  console.log("format state suburb data ...");
  stateSuburbData = JSON
    .parse(data);
  stateSuburbData.features
    .forEach(function(d) {
      d.properties = { name: d.properties.SSC_NAME16 };
    });

  console.log("load Canberra-Queanbeyan borders ...");
  fs.readFile("canberraQueanbeyan.geojson", "utf8", function(error, data) {
    if (error) throw error;

    cbrQbnData = JSON
      .parse(data);
    console.log("filtering suburbs ...");
    cbrQbnSuburbs = stateSuburbData
      .features
      .filter(function(d) {
        if (d3.geoContains(cbrQbnData, d3.geoCentroid(d))) {
          console.log(d.properties.name);
          return d;
        }
      });
    console.log(cbrQbnSuburbs.length + " suburbs");
    cbrQbnSuburbs = { type: "FeatureCollection", features: cbrQbnSuburbs };

    fs.writeFile("cbrQbnSuburbs.geojson", JSON.stringify(cbrQbnSuburbs), function(error) {
      console.log("cbrQbnSuburbs.geojson written");
    });
  });
});
